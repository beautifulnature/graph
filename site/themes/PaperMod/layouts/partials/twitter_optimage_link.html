{{ $image := resources.GetMatch . }} 
{{ $imageLink := .}}

{{ if $image }}
  {{ if gt $image.Width 800 }}
    {{ $image = $image.Resize "800x jpg" }}
  {{else}}
    {{ $resizeOptions := printf "%dx%d jpg" $image.Width $image.Height }}
    {{ $image = $image.Resize $resizeOptions }}
  {{ end }}
  {{$imageLink = $image.RelPermalink}}
{{ end }}
{{ return $imageLink }}